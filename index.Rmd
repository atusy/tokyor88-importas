---
title: importas if Python
subtitle: "Tokyo.R 88"
date: "`r Sys.Date()`"
author: Atusy
output:
  revealjs::revealjs_presentation:
    keep_md: true
    self_contained: false
    center: true
    css: revealjs.css
    mathjax: null
    pandoc_args:
      - "--lua-filter"
      - "filters.lua"
    reveal_options:
      slideNumber: true
    md_extensions: "+emoji"
---

```{r setup, include=FALSE}
library(importas)
`%>%` <- magrittr::`%>%`
```


```{r knitr, include=FALSE}
library(knitr)
opts_chunk$set(
  collapse = TRUE, comment = "#>"
)
```
# {#self-intro}


::: {.col style='width:300px'}

### ***Atusy***

![](https://github.com/atusy/presentation/blob/master/headphone.jpg?raw=true){width=300px}

:::

::: {.col style='width:600px'}

* R Markdowné–¢ä¿‚ã®ã‚³ãƒŸãƒƒã‚¿
* felpã€ftExtraã€minidownãªã©ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã‚’ä½œã£ã¦ã¯TokyoRã§ç´¹ä»‹ã—ã¦ã„ã‚‹
* Pythonã§ãƒ‡ãƒ¼ã‚¿åˆ†æã—ã¦ã‚‹
* ![](https://icongr.am/feather/home.svg)
  [blog.atusy.net](https://blog.atusy.net)
* ![](https://icongr.am/feather/twitter.svg)
  [\@Atsushi776](https://twitter.com/Atsushi776)

:::

# æä¾›

[![ã‚¹ãƒãƒ³ã‚µãƒ¼æ§˜ä¸€è¦§](img-sponsors.png)](https://github.com/sponsors/atusy)

<https://github.com/sponsors/atusy>

# ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã®å¹²æ¸‰ğŸ‘ {#conflicts}

```{r, include=FALSE}
library(dplyr)
library(MASS)
```


```{r, error=TRUE}
mtcars %>% select(mpg)
```
## å…¥ã‚Œæ›¿ã‚ã£ã¦ã‚‹ï¼Ÿï¼

```{r}
select
```


# ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸::é–¢æ•°ğŸ‘ {#avoid-conflicts}

æ­£ç›´ã ã‚‹ã„

```{r, fig.height=2}
ggplot2::ggplot(mtcars) +
  ggplot2::aes(wt, mpg) +
  ggplot2::geom_point() +
  ggplot2::theme_classic()
```


# Pythonã®ã‚¢ãƒ¬ãŒæ¬²ã—ã„  {#python}


```{python}
import datetime as dt
dt.date(2020, 9, 19)
```

# ğŸ“¦importasğŸ‰

```{r, eval=FALSE}
remotes::install_github("atusy/importas")
```

CRANç™»éŒ²ã¯é–“ã«åˆã„ã¾ã›ã‚“ã§ã—ãŸâ€¦â€¦ã€‚

ã‚¹ãƒãƒ³ï¼ï¼

## Pythoné¢¨ {#like-python}

```{r, fig.height=2}
ggplot2 %as% gg
gg$ggplot(mtcars) +
  gg$aes(wt, mpg) +
  gg$geom_point() +
  gg$theme_classic()
```

## Ré¢¨ {#like-r}

```{r, fig.height=2}
gg <- package(ggplot2)
gg$ggplot(mtcars) +
  gg$aes(wt, mpg) +
  gg$geom_point() +
  gg$theme_classic()
```

## è¤‡æ•°ã«åŒæ™‚

```{r}
importas(tb = tibble, td = tidyr)
`%>%` <- magrittr::`%>%`

tb$rownames_to_column(mtcars) %>%
  td$nest(data = -rowname)
```


# å…¥åŠ›è£œå®Œã«å¯¾å¿œ

![å…¥åŠ›è£œå®Œã®ä¾‹](img-auto-completion.png)


# å®Œå…¨ä¸€è‡´ã®ã¿è¨±å¯

```{r, error=TRUE}
gg$ggplo
gg$ggplot
```

## é€šå¸¸ã®`$`ã¯å‰æ–¹ä¸€è‡´

```{r}
identical(
  mtcars$mpg,
  mtcars$m
)
```

# ãƒ˜ãƒ«ãƒ—ã¯è¦‹ã‚Œãªã„

```{r, error=TRUE}
?gg$ggplot
```


# ä»•çµ„ã¿

## ã‚¨ã‚¤ãƒªã‚¢ã‚¹ã®å®Ÿæ…‹

* `importas`ã‚¯ãƒ©ã‚¹ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆ
* å®Ÿæ…‹ã¯åå‰ä»˜ããƒªã‚¹ãƒˆ
    * å€¤ã¯ã™ã¹ã¦`NULL`
    * ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆã•ã‚ŒãŸã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã‚’åå‰ã«æŒã¤
    * åå‰ãŒã‚ã‚‹ã®ã§å…¥åŠ›è£œå®ŒãŒå¯èƒ½

```{r}
str(gg)
```

## `$`æ¼”ç®—å­ã®ä¸­èº«

`::`æ¼”ç®—å­ã¨åŒæ§˜`getExportedValue`é–¢æ•°ã‚’ä½¿ã†

```{r}
importas:::`$.importas`
```

```{r}
`::`
```

## `<-`ã—ãŸã‚¨ã‚¤ãƒªã‚¢ã‚¹ã®å±…å ´æ‰€

`.GlobalEnv`

```{r}
ls()
```

## ãã®ä»–ã®ã‚¨ã‚¤ãƒªã‚¢ã‚¹ã®å±…å ´æ‰€

ã‚µãƒ¼ãƒãƒ‘ã‚¹ã«`attach`ã—ãŸ`"importas:alias"`

```{r}
ls(envir=as.environment("importas:alias"))
```

# ä½™è«‡

## `.GlobalEnv`æ±šæŸ“ç¦æ­¢

importas 0.1.0ã§ã¯`%as%`æ¼”ç®—å­ã‚„`importas`é–¢æ•°ã‚‚ \
`.GlobalEnv`ã«ã‚¨ã‚¤ãƒªã‚¢ã‚¹ã‚’ä½œã£ã¦ã„ãŸ

ãŒ

> Thanks, but modification of the .GlobalEnv is a policy violation.

## `attach`é–¢æ•°ã‚’ä½¿ãŠã†

- ã‚µãƒ¼ãƒãƒ‘ã‚¹ã‚’è¿½åŠ 
- `.GlobalEnv`æ±šæŸ“ã®å›é¿ã«ä½¿ãˆã‚‹
- Good Practice (`?attach`)
    - åŸºæœ¬çš„ã«ã¯`with`é–¢æ•°ã§ä»£ç”¨ã›ã‚ˆ
    - ã©ã†ã—ã¦ã‚‚å¿…è¦ãªã‚‰`on.exit`ã§`detach`ã›ã‚ˆ

ã„ã‚„ã€`.onLoad`ã§`attach`ã—ã¦ã€`.unLoad`ã§`detach`ã—ãŸã„ã‚“ã‚„ã‘ã©â€¦â€¦ï¼Ÿ

## Good Practiceé•åç¦æ­¢ï¼Ÿ

`attach`ã—ãŸã‚‰`on.exit`ã§`detach`ã—ãªã„ã¨ \
R CMD checkã«æ€’ã‚‰ã‚Œã‚‹

å›é¿ã™ã‚‹ã«ã¯`do.call`ã‚’çµŒç”±ã—ã‚ˆã†ã€‚

```r
.onLoad <- function(libname, pkgname) {
  do.call("attach", list(what = NULL, name = "importas:alias"))
}
```

## é»’é­”è¡“ã¯é»’é­”è¡“ã‚’å‘¼ã¶

# Enjoy!!
